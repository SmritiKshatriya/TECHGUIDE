<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign Up â€” TechGuide</title>
    <link rel="stylesheet" href="/static/css/styles.css">
</head>
<body>

<nav class="navbar">
    <a href="/" class="navbar-logo">Tech Guide ðŸš€</a>
    <div class="navbar-links">
        <a href="/">Home</a>
        <a href="/quiz/">Quiz</a>
        <a href="/roadmaps/">Roadmaps</a>
        <a href="/login/" class="btn-outline">Log In</a>
    </div>
</nav>

<div style="max-width:420px; margin:4rem auto; padding:0 1.5rem;">
    <div style="background:#1E293B; border:1px solid #334155; border-radius:1rem; padding:2rem;">
        <h1 style="font-size:1.75rem; font-weight:800; margin-bottom:0.5rem;">Create account</h1>
        <p style="color:#94A3B8; margin-bottom:2rem;">Start your tech journey with TechGuide</p>

        <div id="error-msg" style="display:none; background:#EF444420; border:1px solid #EF4444; color:#EF4444; padding:0.75rem; border-radius:0.5rem; margin-bottom:1rem; font-size:0.9rem;"></div>
        <div id="success-msg" style="display:none; background:#10B98120; border:1px solid #10B981; color:#10B981; padding:0.75rem; border-radius:0.5rem; margin-bottom:1rem; font-size:0.9rem;"></div>

        <div style="margin-bottom:1rem;">
            <label style="display:block; color:#94A3B8; font-size:0.875rem; margin-bottom:0.5rem;">Username</label>
            <input type="text" id="username" placeholder="Choose a username"
                style="width:100%; padding:0.75rem 1rem; background:#0F172A; border:1px solid #334155; border-radius:0.5rem; color:white; font-size:1rem; outline:none; box-sizing:border-box;">
        </div>

        <div style="margin-bottom:1rem;">
            <label style="display:block; color:#94A3B8; font-size:0.875rem; margin-bottom:0.5rem;">Email</label>
            <input type="email" id="email" placeholder="Enter your email"
                style="width:100%; padding:0.75rem 1rem; background:#0F172A; border:1px solid #334155; border-radius:0.5rem; color:white; font-size:1rem; outline:none; box-sizing:border-box;">
        </div>

        <div style="margin-bottom:1rem;">
            <label style="display:block; color:#94A3B8; font-size:0.875rem; margin-bottom:0.5rem;">Password</label>
            <input type="password" id="password" placeholder="Min 6 characters"
                style="width:100%; padding:0.75rem 1rem; background:#0F172A; border:1px solid #334155; border-radius:0.5rem; color:white; font-size:1rem; outline:none; box-sizing:border-box;">
        </div>

        <div style="margin-bottom:1.5rem;">
            <label style="display:block; color:#94A3B8; font-size:0.875rem; margin-bottom:0.5rem;">Confirm Password</label>
            <input type="password" id="confirm-password" placeholder="Repeat your password"
                style="width:100%; padding:0.75rem 1rem; background:#0F172A; border:1px solid #334155; border-radius:0.5rem; color:white; font-size:1rem; outline:none; box-sizing:border-box;">
        </div>

        <button onclick="handleSignup()" id="signup-btn"
            style="width:100%; padding:0.875rem; background:#3B82F6; color:white; border:none; border-radius:0.5rem; font-size:1rem; font-weight:600; cursor:pointer;">
            Create Account
        </button>

        <p style="text-align:center; color:#94A3B8; margin-top:1.5rem; font-size:0.9rem;">
            Already have an account?
            <a href="/login/" style="color:#3B82F6;">Log in</a>
        </p>
    </div>
</div>

<script>
    function getCookie(name) {
        let value = null;
        if (document.cookie) {
            document.cookie.split(';').forEach(c => {
                c = c.trim();
                if (c.startsWith(name + '=')) {
                    value = decodeURIComponent(c.substring(name.length + 1));
                }
            });
        }
        return value;
    }

    async function handleSignup() {
        const username = document.getElementById('username').value.trim();
        const email = document.getElementById('email').value.trim();
        const password = document.getElementById('password').value;
        const confirmPassword = document.getElementById('confirm-password').value;
        const errorMsg = document.getElementById('error-msg');
        const successMsg = document.getElementById('success-msg');
        const btn = document.getElementById('signup-btn');

        errorMsg.style.display = 'none';
        successMsg.style.display = 'none';

        if (!username || !email || !password || !confirmPassword) {
            errorMsg.textContent = 'Please fill in all fields';
            errorMsg.style.display = 'block';
            return;
        }

        btn.textContent = 'Creating account...';
        btn.disabled = true;

        try {
            const res = await fetch('/api/accounts/signup/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCookie('csrftoken')
                },
                body: JSON.stringify({
                    username,
                    email,
                    password,
                    confirm_password: confirmPassword
                })
            });

            const data = await res.json();

            if (res.ok) {
                localStorage.setItem('user', JSON.stringify(data.user));
                successMsg.textContent = 'Account created! Redirecting...';
                successMsg.style.display = 'block';
                const redirect = localStorage.getItem('redirectAfterLogin') || '/';
                localStorage.removeItem('redirectAfterLogin');
                setTimeout(() => window.location.href = redirect, 1500);
            } else {
                errorMsg.textContent = data.error;
                errorMsg.style.display = 'block';
                btn.textContent = 'Create Account';
                btn.disabled = false;
            }
        } catch(err) {
            errorMsg.textContent = 'Something went wrong. Please try again.';
            errorMsg.style.display = 'block';
            btn.textContent = 'Create Account';
            btn.disabled = false;
        }
    }

    document.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') handleSignup();
    });
</script>

</body>
</html>
